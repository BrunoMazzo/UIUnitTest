# Couldn't automatically generate a config from your source code.
# This is a generic template to serve as a base for your custom config
# See: https://circleci.com/docs/configuration-reference
version: 2.1
jobs: # a basic unit of work in a run
  test: # your job name
    macos:
      xcode: 15.3.0 # indicate your selected version of Xcode
    steps: # a series of commands to run
      - checkout  # pull down code from your version control system.
      - restore_cache:
          key: spm-cache-{{ checksum "Client/Client.xcodeproj/project.xcworkspace/xcshareddata/swiftpm/Package.resolved" }}
      - run:
          name: Run Unit Tests
          command: xcodebuild -project Client/Client.xcodeproj -scheme Client test -destination 'platform=iOS Simulator,name=iPhone 15,OS=17.4' -clonedSourcePackagesDirPath SourcePackages
      - save_cache:
          paths:
            - SourcePackages/
          key: spm-cache-{{ checksum "Client/Client.xcodeproj/project.xcworkspace/xcshareddata/swiftpm/Package.resolved" }}
  test-parallel: # your job name
    macos:
      xcode: 15.3.0 # indicate your selected version of Xcode
    steps: # a series of commands to run
      - checkout  # pull down code from your version control system.
      - restore_cache:
          key: spm-cache-{{ checksum "Client/Client.xcodeproj/project.xcworkspace/xcshareddata/swiftpm/Package.resolved" }}
      - run:
          name: Run Unit Tests
          command: xcodebuild -project Client/Client.xcodeproj -scheme "ClientTests - Parallel" test -destination 'platform=iOS Simulator,name=iPhone 15,OS=17.4' -parallel-testing-enabled YES -parallel-testing-worker-count 2 -clonedSourcePackagesDirPath SourcePackages
      - save_cache:
          paths:
            - SourcePackages/
          key: spm-cache-{{ checksum "Client/Client.xcodeproj/project.xcworkspace/xcshareddata/swiftpm/Package.resolved" }}
workflows:
  tests:
    jobs:
      - test
      - test-parallel